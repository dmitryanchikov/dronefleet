# Модуль управления дроном

Модуль для взаимодействия с полетным контроллером Betaflight через MSP протокол.

## Возможности

- Чтение данных о положении дрона (крен, тангаж, рыскание)
- Чтение данных о батарее
- Прямое взаимодействие через MSP протокол

## Использование

1. Подключите дрон через USB
2. Убедитесь, что Betaflight Configurator закрыт
3. Настройте порт в файле `.env` в корне проекта:
   ```bash
   PORT=/dev/tty.usbmodem327F357730331  # измените на ваш порт
   ```

## Команды запуска

Модуль предоставляет две реализации для работы с дроном:

### 1. Собственная реализация MSP протокола

Запуск мониторинга телеметрии через нашу реализацию протокола MSP:
```bash
python -m drone_control.msp_telemetry
```

### 2. Реализация с использованием pyMultiWii

**ВАЖНО**: Реализация с pyMultiWii предназначена только для Pluto Drone, который использует TCP/IP соединение, а не USB. Для Betaflight через USB она не подходит.

```bash
python -m drone_control.pymultiwii_telemetry
```

### Сравнение реализаций

- **msp_telemetry.py** - прямая реализация протокола MSP для Betaflight через USB
- **pymultiwii_telemetry.py** - демонстрационная реализация для Pluto Drone через TCP/IP

## Структура модуля

- `msp_telemetry.py` - основной файл для чтения телеметрии через MSP протокол
  - Класс `MSPProtocol` - реализация протокола MSP
  - Функции для чтения данных о положении и батарее
  - Интерактивный режим для мониторинга в реальном времени

- `pymultiwii_telemetry.py` - демонстрационный файл для Pluto Drone
  - Работает только с TCP/IP соединением
  - Демонстрирует базовые команды управления
  - Не поддерживает чтение телеметрии

## Структура протокола MSP

Программа использует следующие MSP команды:
- `MSP_ATTITUDE` (108) - получение данных о положении
- `MSP_ANALOG` (110) - получение данных о батарее
- `MSP_RAW_IMU` (102) - получение данных с датчиков

## Формат пакетов MSP

Каждый пакет MSP имеет следующую структуру:
```
$M<len cmd payload checksum
```
где:
- `$M<` - заголовок пакета
- `len` - длина payload (1 байт)
- `cmd` - команда (1 байт)
- `payload` - данные (опционально)
- `checksum` - контрольная сумма (1 байт)

## Отладка

Если возникают проблемы с подключением:
1. Проверьте, что порт свободен: `lsof | grep usbmodem`
2. Проверьте права доступа к порту
3. Убедитесь, что в `.env` файле указан правильный порт
4. Если порт не определяется автоматически, проверьте доступные порты:
   ```bash
   ls /dev/tty.* /dev/cu.*
   ``` 